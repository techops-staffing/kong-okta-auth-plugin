language: python

sudo: false

services:
- docker

env:
  matrix:
  - LUA="lua=5.1"
  - secure: hsDt+D13SaNPyrujFFnKurE1JqMTziGD3UW7c46dgGCfQL6mgFvPNhejl520T2+i3BaXnISDhv2sS/LVQVUCJ7Zq96G0BPHEa3WV/Tph8NSCASFq0jBjUR7mytTkHHzSpcfJmHQ8eLIkw55+M4PxN6C9wjvxEHTrj9K9UxFOEph9vvNbf9/e74EU3jcRoCz4nvR6r/uQBOPdLz3okYJS2adtvwbljWZYHe8KrE210PVc17+k1ejplSRQJw4NvzxWPHkpo80rVSigEDzREae36c+KlVspP6scqv+HOnJRxhh9oG1pr9Z5eoVu3kOVd5XbKvSVOO2u7roOjedJ5N4cmSzmNffwH4juhJI4mCK/I/njZ5V12DkXVnpUUmeK3UvfOWccC/CbNCzLiZqKs/+Na/BKL8qU8ml0p4nK28LT8XeO8Bh8ntabHBvKMb+OpQ1j5szm4BB9kXHwPGLxuPy9AOxSrNsSFyS8RpV93llJRhkV+mT+kfby73W2ESXVaioBaOSDYAo+VVntl1l0HERPBVFxL1dUy6qF1x4X9Ligx0wDxyqaRTTovhFgeMZ7SCUFvY7jZ/SiuxNba02CFtAFi1DZUTHf8EyRZlU0rlxfGEeYJpjLwC2MOba14rEZSeTz9nW8ckqFMW3JSNsi1CLcm6B/iE9WhYmWx/UYy4ZPCEc=
  - secure: biRTKpe0hfCSFuvFqHDx/cfgREc5zsLM86n4juDb9tDcGHriXtMtqpwgDqUVmuNGUrsNiimCI+rQsvFbgIUgDtI9aGaNpaFxWIKRHwQtmh9Smuya5BErq04NwwEhH+WxklYG/W7Zo+bHASkaGADovH25Tljp6Nh1P9GaaC5OdVukvdS8AfFVGRakjghqmREpfWkdhRaAINo2s50TKKSitZeWftYvsHXyqIaVglDrmojUwvUEtsrgipSxzQOTwLgzhlJ4yl8k+CPyCIsVxOpBXRYUd1k0ri3TzoC64+2vQ0WJ1l5Vr82gD4ALSu3I7xvprOFDNAzFt58ysewH+AHJ4CT5gpdj0vo3GOAu9cJgr5305pjlqucgP/5Kuq7pGxTK5TUgcxhXI08IzNcPkjarlrnRynD71ZWpC8sgS9gbgp/JZw0ySSbmOlNgDs2GuGtmF6UG4Lq4d9fECcKzn3G3oqzaPQolcVnMocwhsFFE0Mqa+8Wq4C02zXzcOcQ5htu4dE9N5yiIfieG2U0uY0ih/m9RWh9BaxR7AkvjP3Y3NJnv+muiYY0c0UEJppDmwApdoWlP+TH7mShq8NNjOjjpnou1af28392vVxKgiNvL1P8LD+G57BPc5/zYtRUR29amI77YlHlTUGX9l3vwJiuN27VKQTg8NhVrA8yUprtOkKU=
  - secure: I601XLxbFBPx1kipsCXyo6HBlCkfjzCTFTmJ7TTomG6p178s+WeR+m8+DhBkz6xRxyzxeqS1mEs6qq+G+KgFGfcmhcpBGEB8hpYSIr+zsQjKhQaKtxzQUjd3PiPf+UesAmQ50fZzQGstuZEX17ylLXrDxJ07R/q1EX298pFE18le33uSa2akBqm+OucExVxgMlDIm5mqF9nkd4h8sn/wGazPa3t1BRWUnqxbNyGMtYQpB12jlqLX0+LdRh2sAgm8WnfCZNizkdAOM4u1VBjiWztUX6TlfmEwqHqRY+jJetE/XrBi+t8j9pJ1Fs25LjUsw+mWpu1V3EszMi3yqLkgSYiKkScMj7XcEj52YFFQ1YpC7hZRZjxpeJ9kL0SVd2lHoLJYq6x+2WvxEdFYUDmF2bQHipWzgdYu8nH+jEeR3ugvj/+F4L5I/hf5TMXAqzGknV7FjFwGwyLDP3RBqmxSSoHvr25b+BWPTmnGCr2HmKknhBeaOY3Ax7KlGwvbGuPacmuirlBe/a38Wz+SjxZwdgEXaK5ttUlG52xN1tsPRzCvOQ2mVWonC4TztOWQYqM2I+YdyqPZSL0VchTQUaZvaZCI9nfeKb4AonOM/sBXgZXh2jis6sHMe29ZxrEYpUgVBECvg4zne+hIkT5rp8bhH0X3AEA/cesu8ke7UjAiYgs=
  - secure: a2BT68TVZH4XS49JEOS2QZV84CDONqCTQMsFRl0+NknWdd037aj0F9pLfM4TVDDxd6FpVabWXOUiODg0EabletPBdLhyL0LS2VW5I8nTVZU1151owH+r423p+RKHuDcyykGGMZD5dQeJmSUGRvEXtuWkqOYh+cBVIxpFCvagapxDlV3DV/aa+yLf6vlr1Ug+KFeJxbmYVa0VL+HIeLd+I+hsDa+aNPhraEnv8yyAQVJExQo8g80w94CLZOCB59SdZmwlN9TkOizfcpubFSwiKhWzf9YuBYWtzxIGjJD9xarowydJKSMRv7jobfx6cFX5lc9yFwJ9d3+/bjjK8ck6q1OWLtBZwasvyMqSHbLyN2fiUxM6+1YD9plv/F2BBZkUQ31OeqtwIkv4jP0Y7WbwhdUv+VnhGy3SlxqdkHBuQb7HEedHTB/m4tS8UBSVM+R+uyBRG2lstPBDEW1WggcI/h7WNxEjW9s7tKmIyhh7D/na1gycr4vuq/pkqLrGpIi7GPTmxbhbqXjiuSqgfF9CUO74Y9j8RMCq0DOjppxpx+oU8NnKycGHUL317ecAc9aDH+HyhBMulcizuEliMNgvtwIT3Cvil7zECZn2DOpvNQLnBhrDE5TXnP1Ghep5hfni2n57Xk6OqDlC75gEGeWy7hPl1a0YnuqYi6wEDGyIywo=
  - secure: BuIshTfeks1YczwMNCoT5auzMzuwl7mVMLiqqlMsEMEUf5dkE2yLRPNkdprctLB6CpprSmGqkB/Oo+nX5qPis32bQ0E2cWfbtPXpST0LEefOxjR2SgQY5ez6y7BWCpU16ycT1aUdjeOlChEa0WC4dHTrlOttCKWaS2FTkmMW+D3V88Sx+WA28+fbua9/h0tk5EXOoFA2yi7BifZxAlvlOJUo0zpQx9u7TFJQhTKeEnFZw5C6ixShRvfXfFfDRHqU3fVvphC8QgDHLLkpIj5BM31yUQTP7JdsfDACNA3cxV5QKQE930F+VBJIWB3Sy+VAChhSm+7tlsRLTH9OEWzl5fHOMqc/Nq419o9V69vjvx1KhlJ4UURMj7AK0Mtxzi5dbdn7mEIThawuPrhQ3W8/VLSPBCEFNtSpYCFnfvc5BS5WmjzEzkPVucE627WC73pqRKF9hj3voDLeOwjhtYEojkVbcikVY3soUTSRaBpSKPit58PkFEGOvFuPCCefRKy86l5zZNgFR3YgLxDYzm3N3OEiViFyc5CLyV1gGfd8gqG6N0bKEKK6U7qrr596Koc2jwuDZxhnZZdmQqSpjfMdVWVNAXm1un9AgeUPexkjFxpiNLqfAqlD9taKMXG1f++eZ4LIwk8rxPc97UCf28qH19XVA6VQ2oTqTMcKFk6dokM=
  - secure: vTwcSK+TRgefXog4+4LHRLq4bgRit0tlAW/xdH5xfQ99TPDLfUUeueR83u5kj3IOovimmUUe5TA12zr6S6lCVDRZYOYqNMJqrPdECGj6EjMJCNacuqIX4VNeINAkB3kCTueKD/f/XMeuHNtv5H3lno34pq8gV8iDANhowG/jvZEZ9BxggWzaBkHp5VhPYr/XreCR5SarcjOjFgN24BfHLG9xiO65TqSB2+wdhFZmziBiQ0q3ArAS21YKnIYtutpDX93nDw8K1B++dlLbdgKbhBmVdYpE6k9ouYoaKrVYRZ0HNbNXH/XZp58Y9Cg+8nAfSmcHd39UABJ+oJxhA68hFDLJgw3FZDcxpYy3MCsqfhZZaWQp+DIG6Nq5NLtXmenD3ER0E7e76iMa6U0SowHLWsMIkosYrk6neOqZmtJcOQT8OISdPsH7Y35/kqY7P2Oon1lHmP64F2G+/jBIdy+rF682ZSCDfFS3tcD8PmWoUDr2SHvZTs0K4KhuVlU/FSBI70BgcJ1rJDi1fEQIXC5bk/eQ9uwveb+IYsNN9Qkdw9mXUglTfnUaIt0Mmki1WzpPxZ9YEA5nfWgRScZ6lPe/xpWSyXw1ceSuYdWwP40/WeY/4sJ9ewgLV1TEbE3EtJXIwFWhIdf/Z7T7+b4qvZaZAVFrUZDcHd+62YIjF9WDBD4=

before_install:
- pip install hererocks
- hererocks env --$LUA -rlatest
- source env/bin/activate
- luarocks install kong
- luarocks install busted
- luarocks install lua-cjson
- luarocks install lbase64
- luarocks install luacrypto

install:
- make

script:
- make test
- make build
- make integration-test

notifications:
  email:
    on_success: never
    on_failure: never
